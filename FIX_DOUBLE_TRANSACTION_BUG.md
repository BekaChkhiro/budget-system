# Fix: рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃњрЃљрЃЮрЃарЃЏрЃљрЃњрЃћрЃЉрЃўрЃА рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ

## ­ЪљЏ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃўрЃА рЃљрЃдрЃгрЃћрЃарЃљ

рЃЌрЃЦрЃЋрЃћрЃю рЃерЃћрЃЦрЃЏрЃћрЃюрЃўрЃЌ рЃърЃарЃЮрЃћрЃЦрЃбрЃў 2500 рЃџрЃљрЃарЃўрЃА рЃЉрЃўрЃБрЃ»рЃћрЃбрЃўрЃЌ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃљрЃДрЃЮрЃцрЃўрЃџрЃў рЃўрЃДрЃЮ 2 рЃњрЃљрЃюрЃЋрЃљрЃЊрЃћрЃЉрЃљрЃЊ:
- рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃњрЃљрЃюрЃЋрЃљрЃЊрЃћрЃЉрЃљ: 1500 рЃџрЃљрЃарЃў
- рЃЏрЃћрЃЮрЃарЃћ рЃњрЃљрЃюрЃЋрЃљрЃЊрЃћрЃЉрЃљ: 1000 рЃџрЃљрЃарЃў

рЃарЃЮрЃфрЃљ рЃњрЃљрЃЊрЃљрЃўрЃ«рЃљрЃЊрЃћрЃЌ рЃърЃўрЃарЃЋрЃћрЃџрЃў 1500 рЃџрЃљрЃарЃў, рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃњрЃЋрЃўрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃЊрЃљ:
- **рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў рЃЌрЃљрЃюрЃ«рЃљ: 3000 рЃџрЃљрЃарЃў** РЮї (рЃБрЃюрЃЊрЃљ рЃДрЃЮрЃцрЃўрЃџрЃўрЃДрЃЮ 1500)
- **рЃЊрЃљрЃарЃЕрЃћрЃюрЃўрЃџрЃў рЃЌрЃљрЃюрЃ«рЃљ: -500 рЃџрЃљрЃарЃў** РЮї (рЃБрЃюрЃЊрЃљ рЃДрЃЮрЃцрЃўрЃџрЃўрЃДрЃЮ 1000)

## ­ЪћЇ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃўрЃА рЃЏрЃўрЃќрЃћрЃќрЃў

рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ рЃўрЃДрЃЮ `project_summary` view-рЃўрЃА SQL рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃерЃў. View рЃўрЃДрЃћрЃюрЃћрЃЉрЃЊрЃљ рЃЮрЃа LEFT JOIN-рЃА:

```sql
FROM projects p
LEFT JOIN transactions t ON p.id = t.project_id
LEFT JOIN payment_installments pi ON p.id = pi.project_id
```

рЃћрЃА рЃўрЃгрЃЋрЃћрЃЋрЃЊрЃљ **Cartesian Product**-рЃА (рЃЎрЃљрЃарЃбрЃћрЃАрЃўрЃљрЃюрЃБрЃџ рЃюрЃљрЃЏрЃарЃљрЃЋрЃџрЃА), рЃАрЃљрЃЊрЃљрЃф:
- рЃДрЃЮрЃЋрЃћрЃџрЃў рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ рЃЏрЃарЃљрЃЋрЃџрЃЊрЃћрЃЉрЃЮрЃЊрЃљ рЃњрЃљрЃюрЃЋрЃљрЃЊрЃћрЃЉрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљрЃќрЃћ
- рЃЌрЃБ рЃњрЃљрЃЦрЃЋрЃЌ 2 рЃњрЃљрЃюрЃЋрЃљрЃЊрЃћрЃЉрЃљ рЃЊрЃљ 1 рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ, SQL рЃњрЃљрЃЏрЃЮрЃўрЃдрЃћрЃЉрЃЊрЃљ 2 рЃарЃўрЃњрЃА рЃўрЃЏрЃљрЃЋрЃћ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА
- `SUM(t.amount)` рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃўрЃАрЃљрЃА: 1500 + 1500 = **3000** РЮї

### рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў SQL-рЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃўрЃЌ:

```
project_id | transaction_amount | installment_id
-------------------------------------------------
UUID-123   | 1500              | installment-1
UUID-123   | 1500              | installment-2  <-- рЃЊрЃБрЃЉрЃџрЃўрЃЎрЃљрЃбрЃў!
```

## РюЁ рЃњрЃљрЃЊрЃљрЃгрЃДрЃЋрЃћрЃбрЃљ

рЃерЃћрЃЋрЃфрЃЋрЃљрЃџрЃћрЃЌ view-рЃўрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ рЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃДрЃћрЃюрЃћрЃЌ **subqueries** JOIN-рЃћрЃЉрЃўрЃА рЃюрЃљрЃфрЃЋрЃџрЃљрЃЊ:

### рЃФрЃЋрЃћрЃџрЃў (рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў) SQL:
```sql
SELECT
  COALESCE(SUM(t.amount), 0) as total_received
FROM projects p
LEFT JOIN transactions t ON p.id = t.project_id
LEFT JOIN payment_installments pi ON p.id = pi.project_id
GROUP BY p.id
```

### рЃљрЃ«рЃљрЃџрЃў (рЃАрЃгрЃЮрЃарЃў) SQL:
```sql
SELECT
  COALESCE((
    SELECT SUM(t.amount)
    FROM transactions t
    WHERE t.project_id = p.id
  ), 0) as total_received
FROM projects p
LEFT JOIN payment_installments pi ON p.id = pi.project_id
GROUP BY p.id
```

## ­ЪћД рЃњрЃљрЃЎрЃћрЃЌрЃћрЃЉрЃБрЃџрЃў рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃў

### 1. рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃўрЃљ рЃљрЃ«рЃљрЃџрЃў рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃљ
­ЪЊЂ `migrations/20251001_fix_project_summary_view_v2.sql`
- рЃљрЃдрЃЏрЃЮрЃцрЃ«рЃЋрЃарЃўрЃџрЃўрЃљ transactions JOIN
- рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃБрЃџрЃўрЃљ subquery рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃљрЃњрЃарЃћрЃњрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА
- рЃерЃћрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃБрЃџрЃўрЃљ installments JOIN (рЃарЃљрЃЊрЃњрЃљрЃю рЃЏрЃљрЃА рЃљрЃа рЃљрЃЦрЃЋрЃА рЃњрЃљрЃЋрЃџрЃћрЃюрЃљ transactions-рЃќрЃћ)

### 2. рЃњрЃљрЃАрЃгрЃЮрЃарЃћрЃЉрЃБрЃџрЃўрЃљ TypeScript рЃЋрЃћрЃџрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў
­ЪЊЂ `app/transactions/components/transaction-form.tsx`
- рЃерЃћрЃфрЃЋрЃџрЃўрЃџрЃўрЃљ `received_amount` -> `total_received`
- рЃљрЃ«рЃџрЃљ рЃерЃћрЃћрЃАрЃљрЃЉрЃљрЃЏрЃћрЃЉрЃљ TypeScript interface-рЃА рЃЊрЃљ SQL view-рЃА

## ­ЪЊІ рЃарЃЮрЃњрЃЮрЃа рЃњрЃљрЃЋрЃБрЃерЃЋрЃљрЃЌ рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃљ

### рЃЋрЃљрЃарЃўрЃљрЃюрЃбрЃў 1: Node.js рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃЌ (рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў)

```bash
node run-fix-migration.js
```

### рЃЋрЃљрЃарЃўрЃљрЃюрЃбрЃў 2: Supabase Dashboard-рЃерЃў

1. рЃњрЃљрЃЊрЃљрЃЊрЃў [https://supabase.com/dashboard](https://supabase.com/dashboard)
2. рЃљрЃарЃЕрЃўрЃћ рЃерЃћрЃюрЃў рЃърЃарЃЮрЃћрЃЦрЃбрЃў
3. рЃњрЃљрЃЊрЃљрЃЊрЃў **SQL Editor** рЃњрЃљрЃюрЃДрЃЮрЃцрЃўрЃџрЃћрЃЉрЃљрЃерЃў
4. рЃЊрЃљрЃљрЃЎрЃЮрЃърЃўрЃарЃћ рЃЊрЃљ рЃЕрЃљрЃљрЃАрЃЋрЃў `migrations/20251001_fix_project_summary_view_v2.sql` рЃцрЃљрЃўрЃџрЃўрЃА рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃў
5. рЃЊрЃљрЃљрЃГрЃўрЃарЃћ **Run** рЃдрЃўрЃџрЃљрЃЎрЃА

### рЃЋрЃљрЃарЃўрЃљрЃюрЃбрЃў 3: Supabase CLI-рЃўрЃЌ

```bash
supabase db push
```

## Рюе рЃерЃћрЃЊрЃћрЃњрЃў

рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ:

РюЁ **рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў рЃЌрЃљрЃюрЃ«рЃљ**: 1500 рЃџрЃљрЃарЃў (рЃАрЃгрЃЮрЃарЃў!)
РюЁ **рЃЊрЃљрЃарЃЕрЃћрЃюрЃўрЃџрЃў рЃЌрЃљрЃюрЃ«рЃљ**: 1000 рЃџрЃљрЃарЃў (рЃАрЃгрЃЮрЃарЃў!)

## ­ЪДф рЃарЃЮрЃњрЃЮрЃа рЃЊрЃљрЃЋрЃарЃгрЃЏрЃБрЃюрЃЊрЃћрЃЌ рЃарЃЮрЃЏ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА

1. рЃњрЃљрЃБрЃерЃЋрЃў рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃљ
2. рЃњрЃљрЃЊрЃљрЃЊрЃў рЃърЃарЃЮрЃћрЃЦрЃбрЃћрЃЉрЃўрЃА рЃњрЃЋрЃћрЃарЃЊрЃќрЃћ
3. рЃўрЃърЃЮрЃЋрЃћ рЃърЃарЃЮрЃћрЃЦрЃбрЃў рЃЉрЃўрЃБрЃ»рЃћрЃбрЃўрЃЌ 2500
4. рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃарЃЮрЃЏ:
   - рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃў = 1500 рЃџрЃљрЃарЃў
   - рЃЊрЃљрЃарЃЕрЃћрЃюрЃўрЃџрЃў = 1000 рЃџрЃљрЃарЃў
   - рЃърЃарЃЮрЃњрЃарЃћрЃАрЃў = 60% (1500/2500)

## ­ЪћЇ рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌрЃў рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃЉрЃў

рЃЌрЃБ рЃњрЃўрЃюрЃЊрЃљ SQL-рЃўрЃЌ рЃБрЃерЃБрЃљрЃџрЃЮрЃЊ рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃЮ:

```sql
-- рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃърЃарЃЮрЃћрЃЦрЃбрЃў
SELECT
  p.title,
  p.total_budget,
  ps.total_received,
  ps.remaining_amount,
  ps.payment_progress,
  ps.transactions_count
FROM projects p
JOIN project_summary ps ON ps.id = p.id
WHERE p.total_budget = 2500;

-- рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃДрЃЋрЃћрЃџрЃљ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ рЃљрЃЏ рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃАрЃЌрЃЋрЃўрЃА
SELECT
  t.id,
  t.amount,
  t.transaction_date,
  pi.installment_number
FROM transactions t
LEFT JOIN payment_installments pi ON pi.id = t.installment_id
WHERE t.project_id = 'YOUR_PROJECT_ID';
```

## ­ЪЊџ рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ

### рЃарЃљрЃбрЃЮрЃЏ рЃ«рЃЊрЃћрЃЉрЃЮрЃЊрЃљ рЃћрЃА?

SQL-рЃерЃў, рЃарЃЮрЃфрЃљ рЃњрЃљрЃЦрЃЋрЃА рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃЏрЃћ LEFT JOIN рЃЊрЃљ рЃЏрЃћрЃарЃћ рЃљрЃњрЃарЃћрЃњрЃўрЃарЃћрЃЉ (SUM, COUNT, рЃЊрЃљ рЃљ.рЃе.), SQL рЃЦрЃЏрЃюрЃўрЃА Cartesian Product-рЃА - рЃљрЃюрЃБ рЃДрЃЋрЃћрЃџрЃљ рЃЎрЃЮрЃЏрЃЉрЃўрЃюрЃљрЃфрЃўрЃљрЃА рЃЮрЃарЃўрЃЋрЃћ рЃфрЃ«рЃарЃўрЃџрЃўрЃА рЃарЃўрЃњрЃћрЃЉрЃА рЃерЃЮрЃарЃўрЃА.

### рЃарЃљрЃбрЃЮрЃЏ рЃљрЃарЃўрЃА subquery рЃБрЃЎрЃћрЃЌрЃћрЃАрЃў?

Subquery:
- рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА рЃЊрЃљрЃЏрЃЮрЃБрЃЎрЃўрЃЊрЃћрЃЉрЃџрЃљрЃЊ рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃАрЃЌрЃЋрЃўрЃА
- рЃљрЃа рЃБрЃарЃћрЃЋрЃА рЃњрЃљрЃюрЃЋрЃљрЃЊрЃћрЃЉрЃћрЃЉрЃўрЃА рЃарЃўрЃњрЃћрЃЉрЃА
- рЃњрЃљрЃЏрЃЮрЃўрЃЌрЃЋрЃџрЃўрЃА рЃќрЃБрЃАрЃб рЃЌрЃљрЃюрЃ«рЃљрЃА JOIN-рЃўрЃА рЃњрЃљрЃарЃћрЃерЃћ

### рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃљ (Performance)

PostgreSQL рЃЮрЃърЃбрЃўрЃЏрЃўрЃќрЃљрЃбрЃЮрЃарЃў рЃФрЃљрЃџрЃўрЃљрЃю рЃЎрЃљрЃарЃњрЃљрЃЊ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА subqueries-рЃЌрЃљрЃю рЃЊрЃљ рЃўрЃюрЃЊрЃћрЃЦрЃАрЃћрЃЉрЃЌрЃљрЃю, рЃљрЃЏрЃўрЃбрЃЮрЃЏ:
- рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃљ рЃўрЃњрЃўрЃЋрЃћрЃљ рЃљрЃю рЃБрЃЎрЃћрЃЌрЃћрЃАрЃў
- SQL рЃБрЃцрЃарЃЮ рЃЏрЃљрЃарЃбрЃўрЃЋрЃў рЃЊрЃљ рЃњрЃљрЃАрЃљрЃњрЃћрЃЉрЃў
- рЃерЃћрЃЊрЃћрЃњрЃў рЃАрЃгрЃЮрЃарЃў рЃЊрЃљ рЃърЃарЃЮрЃњрЃюрЃЮрЃќрЃўрЃарЃћрЃЉрЃљрЃЊрЃў

## ­Ъј» рЃЊрЃљрЃАрЃЎрЃЋрЃюрЃљ

рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ рЃўрЃДрЃЮ рЃЎрЃџрЃљрЃАрЃўрЃЎрЃБрЃарЃў SQL Cartesian Product рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ, рЃАрЃљрЃЊрЃљрЃф рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃЏрЃћ LEFT JOIN рЃўрЃгрЃЋрЃћрЃЋрЃЊрЃљ рЃарЃўрЃњрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃарЃљрЃЋрЃџрЃћрЃЉрЃљрЃА. рЃњрЃљрЃЊрЃљрЃЋрЃгрЃДрЃЋрЃўрЃбрЃћрЃЌ subqueries-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ, рЃарЃљрЃф рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА:
- РюЁ рЃќрЃБрЃАрЃб рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃћрЃЉрЃА
- РюЁ рЃЏрЃљрЃарЃбрЃўрЃЋ SQL рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљрЃА
- РюЁ рЃАрЃљрЃюрЃЊрЃЮ рЃерЃћрЃЊрЃћрЃњрЃћрЃЉрЃА
- РюЁ рЃЎрЃљрЃарЃњ рЃерЃћрЃАрЃарЃБрЃџрЃћрЃЉрЃљрЃА

---

**рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃљ**: рЃћрЃА рЃљрЃарЃўрЃА рЃЎрЃарЃўрЃбрЃўрЃЎрЃБрЃџрЃў bug fix. рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃўрЃарЃћрЃЉрЃБрЃџрЃўрЃљ рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃўрЃА рЃЊрЃљрЃБрЃДрЃЮрЃюрЃћрЃЉрЃџрЃўрЃЋ рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ.
